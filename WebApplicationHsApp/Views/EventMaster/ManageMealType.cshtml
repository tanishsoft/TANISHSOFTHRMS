
@{
    ViewBag.Title = "ManageMealType";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="panel panel-default">
    <div class="panel-heading">Manage Meal Type<a href="#" data-toggle="modal" class="pull-right" data-target="#myModalMeal">Add Meal Type</a></div>
    <div class="panel-body">
        <table class="table table-striped table-bordered dt-responsive nowrap" style="width:100%;" id="tblMealTypes">
            <thead>
                <tr style="background-color: #786C67;color: white;">
                    <th>SL.No</th>
                    <th>Name</th>
                    <th>Description</th>
                    @*<th>Document Name</th>*@
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
<div id="myModalMeal" class="modal fade" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4 class="modal-title">Add Meal</h4>
            </div>
            <div class="modal-body">
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Name<span style="color:red;">&nbsp;*</span></label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="mName">
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Description</label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="mDescription">
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <input type="button" id="btnasigntask" value="Save" onclick="validateMeal('S');" class="btn btn-primary">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearData();">Close</button>
            </div>
        </div>

    </div>
</div>
<div id="myModalMealEdit" class="modal fade" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4 class="modal-title">Add Meal</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" class="form-control" id="mMealTypeId">

                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Name<span style="color:red;">&nbsp;*</span></label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="Name">
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Description</label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="Description">
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <input type="button" id="btnUpdate" value="Update" onclick="validateMeal('U');" class="btn btn-primary">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearData();">Close</button>
            </div>
        </div>

    </div>
</div>
<div class="modal fade" id="DeleteConfirmation">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h4>Delete  Record</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" class="form-control" id="Cid">
                <h4>Are You Sure? You Want To Delete This Record.</h4>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-primary" data-dismiss="modal" id="r">Cancel</a>
                <a href="#" class="btn btn-danger" onclick="ConfirmDelete()">Confirm</a>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var validate = true;
    $(document).ready(function () {
        GetAllMealDetails();
    });
    function GetAllMealDetails() {
        var index = 0;
        var oTable = $('#tblMealTypes').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/EventMaster/GetActiveMealDetails",
            "bProcessing": true,
            "bDestroy": true,
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, -1], [10, 20, 30, 50, 100, 150, 200, "All"]],
            "aoColumns": [
                { "sName": "MealTypeId" },
                { "sName": "Name" },
                { "sName": "Description" },
                //{ "sName": "Document1" },
                { "sName": "IsActive" },
                {
                    "sName": "MealTypeId",
                    "bSortable": false,
                    "render": function (data) {
                        return '<div class="btn-group">' +
                            '<div class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-th-list"></span></div>' +
                            '<ul class="dropdown-menu dropdown-menu-right">' +
                            '<li><a href="javascript:void(0);" id="' + data + '" onclick="EditMealDetails(this.id);">Edit</a></li>' +
                            '<li><a href="javascript:void(0);" id="' + data + '" onclick="Delete(this.id);">Delete</a></li>' +
                            '</ul></div>';
                    }
                }
            ],
            "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                $("td:nth-child(1)", nRow).html(iDisplayIndex + 1);
                return nRow;
            }
        });

        $("#tblMealTypes_length").addClass("col-md-6");
        $("#tblMealTypes_length").addClass("col-md-6");
    }
    function validateMeal(type) {
        validate = true;
        $(".css-error").removeClass('css-error');
        var MealTypeId = parseInt($("#mMealTypeId").val()) > 0 ? $("#mMealTypeId").val() : 0;
        if (type == "S") {
            if ($("#mName").val() == "") {
                $("#mName").addClass('css-error');
                validate = false;
            } else {
                $.ajax({
                    type: "POST",
                    url: "/EventMaster/checkMealStatus",
                    data: { name: $("#mName").val(), mealTypeId: MealTypeId },
                    async: false,
                    success: function (result) {
                        if (result) {
                            alert("Meal Name existed.!");
                            validate = false;
                        }
                    },
                    error: function (err) {
                        validate = false;
                    }
                });

            }
            if ($("#mDescription").val() == "") {
                $("#mDescription").addClass('css-error');
                validate = false;
            }
        }
        else if (type == 'U') {
            if ($("#Name").val() == "") {
                $("#Name").addClass('css-error');
                validate = false;
            }
            else {
                $.ajax({
                    type: "POST",
                    url: "/EventMaster/checkMealStatus",
                    data: { name: $("#Name").val(), mealTypeId: MealTypeId },
                    async: false,
                    success: function (result) {
                        if (result) {
                            alert("Meal Name existed.!");
                            validate = false;
                        }
                    },
                    error: function (err) {
                        validate = false;
                    }
                });

            }
            if ($("#Description").val() == "") {
                $("#Description").addClass('css-error');
                validate = false;
            }
        }
        if (validate) {
            saveMealDetails(type);


        }
    }
    function saveMealDetails(type) {
        if (validate) {

            var model = {};
            if (type == "U") {
                model = {
                    MealTypeId: $("#mMealTypeId").val(),
                    Name: $("#Name").val(),
                    Description: $("#Description")
                };
              
            }
            else {
                model = {
                    Name: $("#mName").val(),
                    Description: $("#mDescription").val(),
                    IsActive: true
                }
               
            }
            $.ajax({
                type: "GET",
                url: "/EventMaster/SaveMealDetails",
             
                data: model,
                success: function (result) {
                    alert(result);
                    clearData();
                    GetAllMealDetails();
                },
                error: function (err) {
                    alert(err.statusText);
                    clearData();
                }
            });
        }
    }
    function clearData() {
        $(".error").hide();
        $(".css-error").removeClass('css-error');
        $("#mMealTypeId").val('');
        $("#mName").val("");
        $("#mDescription").val("");
        $("#mDocument1").val("");
        $("#Name").val("");
        $("#Description").val("");
        $("#Document1").val("");
        $("#DeleteConfirmation").modal("hide");
        $("#myModalMeal").modal("hide");
        $("#myModalMealEdit").modal("hide");
        $("#Document1").val(null);
        GetAllMealDetails();
    }
    function EditMealDetails(mealTypeId) {
        var Url = "/EventMaster/GetMealDetails?mealTypeId=" + mealTypeId;
        $.ajax({
            type: "GET",
            url: Url,
            success: function (data) {
                $("#myModalMealEdit").modal();
                var obj = data;
                $("#mMealTypeId").val(obj.MealTypeId);
                $("#Name").val(obj.Name);
                $("#Description").val(obj.Description);
                //$("#tdDocumentName").text(obj.Document1);
            }
        });

    }
    function DeleteMealDetails(mealTypeId) {
        var Url = "/EventMaster/UpdateMealStatus?mealTypeId=" + mealTypeId;
        $.ajax({
            type: "GET",
            url: Url,
            success: function (data) {
                $("#DeleteConfirmation").modal("hide");
            }
        });

    }
    //Show The Popup Modal For DeleteComfirmation
    var Delete = function (Id) {
        $("#mMealTypeId").val(Id);
        $("#DeleteConfirmation").modal("show");
    }
    var ConfirmDelete = function () {
        $.ajax({
            type: "POST",
            url: "/EventMaster/UpdateMealStatus?mealTypeId=" + $("#mMealTypeId").val(),
            success: function (result) {
                $("#DeleteConfirmation").modal("hide");
                GetAllMealDetails();
            }
        });

    }
</script>




