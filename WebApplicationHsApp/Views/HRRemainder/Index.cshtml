
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script>
    var validate = true;
    var eId = 0;
    var oTable;
    $(document).ready(function () {
        LoadData();
        LoadRemainderType();
        $("#selUser").select2({
            ajax: {
                url: "/Home/GetEmployeeSearch",
                type: "get",
                dataType: 'json',

                //delay: 250,
                data: function (params) {
                    return {
                        searchTerm: params.term // search term
                    };
                },
                processResults: function (response) {
                    return {
                        results: response
                    };
                },
                cache: true
            },
            minimumInputLength: 4
        });
        $("#txtLastRenewalDate").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: "dd/mm/yy"
        });
        $("#txtNextRenewalDate").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: "dd/mm/yy"
        });
        $("#txtrenewaldate2").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: "dd/mm/yy"
        });
        $("#txtNextrenewaldate2").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: "dd/mm/yy"
        });
        $('#cbcommonremainder').change(function () {
            if (this.checked) {
                $(".showcommnremainder").hide();

            } else {
                $(".showcommnremainder").show();
            }

        });
    });
    function LoadRemainderType() {
        $.get("/HRRemainder/GetRemainderTypeMaster", function (data) {
            var options = [];
            options.push('<option value="0">Select Type</option>');
            for (var i = 0; i < data.length; i++) {
                options.push('<option value="' + data[i].RemainderTypeId + '">' + data[i].RemainderType + '</option>');
            }
            $("#ddlRemainderType").html(options.join(''));
        });
    }
    function LoadData() {
        oTable =$('#tblRemainderType').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/HRRemainder/AjaxGetRemainder",
            "bProcessing": true,
            "bDestroy": true,
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, -1], [10, 20, 30, 50, 100, 150, 200, "All"]],
            "aoColumns": [
                { "sName": "Id" },
                /*{ "sName": "Name" },*/
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "" },
                { "sName": "IsActive" },
                {
                           "sName": "Id",
                           "bSortable": false,
                           "render": function (data, row, r) {
                               var name = "'" + r[1] + "'";
                               var type = "'" + r[2] + "'";
                               var isActive = "'" + r[3] + "'";
                               return '<div class="btn-group">' +
                                   '<div class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-th-list"></span></div>' +
                                   '<ul class="dropdown-menu dropdown-menu-right">' +
                                   //'<li><a href="javascript:void(0);"  onclick="onEdit(' + name + ',' + data + ',' + isActive + ',' + type + ')">Edit</a></li>' +
                                   '<li><a href="javascript:void(0);"  onclick="DocumentsManage(' + data + ')">Documents</a></li>' +
                                   '<li><a href="javascript:void(0);"  onclick="EditRenewal(' + data + ')">Renewal Update</a></li>' +
                                   '<li><a href="javascript:void(0);"  onclick="StatusChange(' + data + ')">Change Status</a></li>' +
                                   '<li><a href="javascript:void(0);"  onclick="onDelete(' + data + ')">Delete</a></li>' +
                                   '</ul></div>';
                           }
                }
            ]
        });
        $("#tblDiet_length").addClass("col-md-6");
        $("#tblDiet_length").addClass("col-md-6");
    }
    function DocumentsManage(id) {
        eId = id;

        BindListoffiles(id);
        $("#divManageDocuments").modal("show");
    }

    function Uploaddataclick() {
        if (window.FormData !== undefined) {
            var fileUpload = $("#selectfiletoupload").get(0);
            var files = fileUpload.files;
            var fileData = new FormData();
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }
            fileData.append('id', eId);
            fileData.append('Notes', $("#txtnotes").val());
            fileData.append('RenewalDate', $("#txtrenewaldate2").val());
            fileData.append('NextRenewalDate', $("#txtNextrenewaldate2").val());
            $.ajax({
                url: '/HRRemainder/UploadFilesForRemainder',
                type: "POST",
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: fileData,
                success: function (result) {
                    alert(result);
                    oTable.api().ajax.reload(null, false);
                    BindListoffiles(eId);
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        } else {
            alert("FormData is not supported.");
        }
    }
    function BindListoffiles(id) {
        $.get("/HRRemainder/GetListOfFiles", { id: id }, function (data) {
            var html = "<table class='table  table-bordered'><tr style='background-color:teal;color:white;'><td>Renewal Date</td><td>Notes</td><td> Action</td></tr>";
            for (var i = 0; i < data.length; i++) {
                html += "<tr><td>" + data[i].RenewalDate + "</td><td>" + data[i].Notes + "</td><td><a  target='_blank' href='/ExcelUplodes/" + data[i].DocumentUrl + "'>View</a> </td></tr>";
            }
            html + "</table>";
            $("#Divdocumentshistory").html(html);
        });
    }

    function EditRenewal(id) {
        eId = id;
        alert(id);
    }
    function StatusChange(id) {
        eId = id;
        $("#divManageStatus").modal('show');
    }
    function OnclickSave() {
        validateCategory();
        if (validate) {
            var empid = 0;
            if ($("#selUser").val() != null && $("#selUser").val() != "") {
                empid = parseInt($("#selUser").val());
            }
            var task = {
                RemainderId:eId,
                Title: "",
                RemainderTypeId: $("#ddlRemainderType").val(),
                EmpId: empid,
                /*CollageName: $("#txtCollageName").val(),*/
                NursingCouncil: $("#txtNursingCouncil").val(),
                FirstRegistrationCouncil: $("#txtFirstRegistrationCouncil").val(),
                RegistrationNumber: $("#txtRegistrationNumber").val(),
                LastRenewalDate: $("#txtLastRenewalDate").val(),
                NextRenewalDate: $("#txtNextRenewalDate").val(),
                Status: $("#ddlStatus").val(),
                Remarks: $("#txtRemarks").val(),
                IsActive: true,
                IsCommon: $("#cbcommonremainder").prop('checked')
            };
            $.ajax({
                type: "POST",
                url: "/HRRemainder/SaveRemainder",
                data: task,
                success: function (data) {
                    $("#myModal").modal('hide');
                    clearAll(); oTable.api().ajax.reload(null, false);

                }
            });
        }
    }
    function validateCategory() {
        validate = true;
        $(".css-error").removeClass('css-error');
        if ($("#ddlRemainderType").val() == "") {
            $("#ddlRemainderType").addClass('css-error');
            validate = false;
        }
    }
        function onDelete(id) {
        if (confirm('Are you sure you want to delete?')) {
            $.getJSON("@Url.Action("DeleteCMPDiet", "InPatientCms")", { id: id }, function (data) {
                clearAll();
                LoadData();
            });
        } return false;
    }
    function onEdit(a, b, c,d) {
        clearAll();
        eId = b;
        $("#Name").val(a);
        $("#ddlPatientType").val(d);
        if(c=="True")
            $("#IsActive").prop('checked', true);
        else
            $("#IsActive").prop('checked', false);
        $("#myModal").modal('show');
        $("#header").text("Update Diet");
    }
    function clearAll() {
        $("#header").text("New Diet");
        $(".css-error").removeClass('css-error');
        $("#Name").val("");
        $("#IsActive").prop('checked', true);
        eId = 0;
    }
    function OnclickSaveStatus() {
        $.get("/HRRemainder/UpdateStatus", { id: eId, status: $("#ddlStatus2").val() }, function (data) {
            oTable.api().ajax.reload(null, false);
            $("#divManageStatus").modal('hide');
            //alert(data);
        });
    }
    function Uploaddataclickfile() {
        if (window.FormData !== undefined) {
            var fileUpload = $("#selectfiletouploadnew").get(0);
            var files = fileUpload.files;
            var fileData = new FormData();
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }

            $.ajax({
                url: '/HRRemainder/UploadFilesForRemainderImportExcel',
                type: "POST",
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: fileData,
                success: function (result) {
                    alert(result);
                    oTable.api().ajax.reload(null, false);
                    $("#divImportExcelupload").modal('hide');
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        } else {
            alert("FormData is not supported.");
        }
    }
</script>
<div class="panel panel-default">
    <div class="panel-heading" style="height:35px;">Manage Reminders<a href="#" data-toggle="modal" class="pull-right" data-target="#myModal">New</a><a href="#" data-toggle="modal" class="pull-right" data-target="#divImportExcelupload">Import &nbsp;&nbsp;</a></div>
    <div class="panel-body">
        <table class="table table-striped table-bordered dt-responsive nowrap" style="width:100%;" id="tblRemainderType">
            <thead>
                <tr style="background-color:chocolate;color:white;">
                    <th>Id</th>
                    @*<th>Title</th>*@
                <th>Reminder Type</th>
                    <th>Employee</th>
                    <th>Collage Name</th>
                    <th>Date Of Joining</th>
                    <th>Nursing Council</th>
                    <th>First Reg Council</th>
                    <th>Reg Number</th>
                    <th>Last Renewal Date</th>
                    <th>Next Renewal Date </th>
                    <th>Status</th>
                    <th>Notes</th>
                    <th>Is Active</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="myModal" class="modal fade" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" onclick="clearAll();">×</button>
                <h4 class="modal-title" id="header">New Reminder</h4>
            </div>
            <div class="modal-body">

                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Reminder Type<span style="color:red;">*</span></label>
                    </div>
                    <div class="col-md-8">
                        <select class="form-control" id="ddlRemainderType">
                            <option value="0">Select</option>
                        </select>
                    </div>
                </div>
                <div class="row" style="padding:5px;display:none;">
                    <div class="col-md-4">
                        <label for="name">Title<span style="color:red;">*</span></label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="txtTitle" autocomplete="off" />
                    </div>
                </div>
                <div class="row" style="padding: 5px; display: none;">
                    <div class="col-md-4">
                        <label for="name">Is Common Reminder</label>
                    </div>
                    <div class="col-md-8">
                        <input type="checkbox" class="form-control" id="cbcommonremainder" autocomplete="off" />
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Select Employee<span style="color:red;">*</span></label>
                    </div>
                    <div class="col-md-8">
                        <select id="selUser" class="form-control typeahead border-primary" name="query" data-provide="typeahead" autocomplete="off" style="width:100%;"></select>
                    </div>
                </div>

                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Nursing Council</label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="txtNursingCouncil" autocomplete="off" />
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">First Registration Council</label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="txtFirstRegistrationCouncil" autocomplete="off" />
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Registration Number</label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="txtRegistrationNumber" autocomplete="off" />
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Last Renewal Date</label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="txtLastRenewalDate" readonly="readonly" autocomplete="off" />
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Next Renewal Date</label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="txtNextRenewalDate" readonly="readonly" autocomplete="off" />
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Status</label>
                    </div>
                    <div class="col-md-8">
                        <select class="form-control" id="ddlStatus">
                            <option value="">Select</option>
                            <option value="Trainee">Trainee</option>
                            <option value="Expired">Expired</option>
                            <option value="Active">Active</option>
                        </select>
                    </div>
                </div>
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Notes</label>
                    </div>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="txtRemarks" autocomplete="off" />
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <input type="button" id="btnasigntask" value="Save" onclick="OnclickSave();" class="btn btn-primary">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearAll();">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="divManageDocuments" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Manage Documents</h4>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <td>
                            Notes :
                        </td>
                        <td>
                            <textarea id="txtnotes" class="form-control" rows="2"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Renewal Date :
                        </td>
                        <td>
                            <input type="text" id="txtrenewaldate2" class="form-control" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Next Renewal Date :
                        </td>
                        <td>
                            <input type="text" id="txtNextrenewaldate2" class="form-control" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Select File  :
                        </td>
                        <td>
                            <input type="file" name="file" id="selectfiletoupload" multiple />
                        </td>
                        <td>
                            <input type="button" id="btnUploadfile" class="btn btn-primary" value="Upload" onclick="Uploaddataclick();" />
                        </td>
                    </tr>

                </table>
                <div class="row" style="padding:5px;" id="Divdocumentshistory">

                </div>
            </div>
            <div class="modal-footer">

                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div id="divManageStatus" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Update Status</h4>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <td>
                            Status :
                        </td>
                        <td>
                            <select class="form-control" id="ddlStatus2">
                                <option value="">Select</option>
                                <option value="Trainee">Trainee</option>
                                <option value="Expired">Expired</option>
                                <option value="Active">Active</option>

                            </select>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <input type="button" id="btnasigntask" value="Save" onclick="OnclickSaveStatus();" class="btn btn-primary" />
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div id="divImportExcelupload" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Upload Excel</h4>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <td>
                            Select File :
                        </td>
                        <td>
                            <input type="file" name="file" id="selectfiletouploadnew" />
                        </td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <input type="button" id="btnasigntask" value="Save" onclick="Uploaddataclickfile();" class="btn btn-primary" />
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>