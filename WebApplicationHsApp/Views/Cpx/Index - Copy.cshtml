
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>

    .card {
        margin-bottom: 1.875rem;
        border: none;
        border-radius: 0;
        -webkit-box-shadow: 0 10px 40px 0 rgba(62,57,107,.07),0 2px 9px 0 rgba(62,57,107,.06);
        box-shadow: 0 10px 40px 0 rgba(62,57,107,.07),0 2px 9px 0 rgba(62,57,107,.06)
    }

        .card .card {
            -webkit-box-shadow: none !important;
            box-shadow: none !important
        }

        .card .card-title {
            font-weight: 500;
            letter-spacing: .05rem;
            font-size: 1.12rem
        }

        .card .card-bordered {
            border: 1px solid rgba(0,0,0,.06)
        }

        .card.card-fullscreen {
            display: block;
            z-index: 9999;
            position: fixed;
            width: 100% !important;
            height: 100% !important;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            overflow: auto
        }

        .card .card-body[class*=border-bottom-] {
            border-bottom-width: 2px !important
        }

        .card .card-img-overlay.bg-overlay {
            background: rgba(0,0,0,.45)
        }

        .card .card-img-overlay .text-muted {
            color: #1B2942 !important
        }

        .card.card-minimal {
            border: none;
            -webkit-box-shadow: none;
            box-shadow: none
        }

    .card-body {
        -webkit-box-flex: 1;
        -webkit-flex: 1 1 auto;
        -moz-box-flex: 1;
        -ms-flex: 1 1 auto;
        flex: 1 1 auto;
        padding: 1.5rem;
    }

    .table-responsive {
        display: block;
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .card-moved .card, .card-moved .card-header {
        background-color: #FFA87D;
        color: #FFF
    }

    .handle, .titleArea {
        cursor: move
    }

    .card-header {
        border-bottom: none
    }

        .card-header .card-title {
            margin-bottom: 0
        }

        .card-header .heading-elements, .card-header .heading-elements-toggle {
            background-color: inherit;
            position: absolute;
            top: 20px;
            right: 21px
        }

            .card-header .heading-elements-toggle.heading-top-elements .page-item, .card-header .heading-elements.heading-top-elements .page-item {
                display: inline-block
            }

            .card-header .heading-elements a, .card-header .heading-elements-toggle a {
                padding: 0 8px
            }

                .card-header .heading-elements a.btn, .card-header .heading-elements-toggle a.btn {
                    padding-top: 6px;
                    padding-bottom: 6px
                }

    .card-footer {
        border-top: 1px solid #EEE
    }

    .media {
        display: flex;
        -webkit-box-align: start;
        -webkit-align-items: flex-start;
        -moz-box-align: start;
        -ms-flex-align: start;
        align-items: flex-start
    }

    .media-body {
        -webkit-box-flex: 1;
        -webkit-flex: 1;
        -moz-box-flex: 1;
        -ms-flex: 1;
        flex: 1;
    }

    .align-items-stretch {
        -webkit-box-align: stretch !important;
        -webkit-align-items: stretch !important;
        -moz-box-align: stretch !important;
        -ms-flex-align: stretch !important;
        align-items: stretch !important;
    }

    .white {
        color: #FFF !important;
    }

    .bg-primary {
        background-color: #00B5B8 !important;
    }

        .bg-primary.bg-darken-2, .btn-primary.btn-darken-2 {
            background-color: #008385 !important;
        }

    .bg-danger.bg-darken-2, .btn-danger.btn-darken-2 {
        background-color: #FF425C !important;
    }

    .bg-warning.bg-darken-2, .btn-warning.btn-darken-2 {
        background-color: #FF864A !important;
    }

    .bg-success.bg-darken-2, .btn-success.btn-darken-2 {
        background-color: #11A578 !important;
    }

    .text-center {
        text-align: center !important;
    }

    .p-2 {
        padding: 1.5rem !important;
    }

    .font-large-2 {
        font-size: 5rem !important;
    }

    .bg-gradient-x-primary {
        background-image: -webkit-gradient(linear,left top,right top,from(#008385),to(#00E7EB));
        background-image: -webkit-linear-gradient(left,#008385 0,#00E7EB 100%);
        background-image: -moz-linear-gradient(left,#008385 0,#00E7EB 100%);
        background-image: -o-linear-gradient(left,#008385 0,#00E7EB 100%);
        background-image: linear-gradient(to right,#008385 0,#00E7EB 100%);
        background-repeat: repeat-x;
    }

    .h5, h5 {
        font-size: 1.74rem;
    }

    .text-bold-400 {
        font-weight: 400;
    }

    .mb-0, .my-0 {
        margin-bottom: 0 !important;
    }

    .primary {
        color: #00B5B8 !important
    }

    .danger {
        color: #FF7588 !important;
    }

    .bg-danger {
        background-color: #FF7588 !important;
    }

    .success {
        color: #16D39A !important;
    }

    .bg-success {
        background-color: #16D39A !important;
    }

    .warning {
        color: #FFA87D !important;
    }

    .bg-warning {
        background-color: #FFA87D !important;
    }

    #container {
        height: 400px;
        max-width: 800px;
        margin: 0 auto;
    }

    /* Link the series colors to axis colors */
    .highcharts-color-0 {
        fill: #7cb5ec;
        stroke: #7cb5ec;
    }

    .highcharts-axis.highcharts-color-0 .highcharts-axis-line {
        stroke: #7cb5ec;
    }

    .highcharts-axis.highcharts-color-0 text {
        fill: #7cb5ec;
    }

    .highcharts-color-1 {
        fill: #90ed7d;
        stroke: #90ed7d;
    }

    .highcharts-axis.highcharts-color-1 .highcharts-axis-line {
        stroke: #90ed7d;
    }

    .highcharts-axis.highcharts-color-1 text {
        fill: #90ed7d;
    }


    .highcharts-yaxis .highcharts-axis-line {
        stroke-width: 2px;
    }

    .nav-pills li a {
        color: white;
    }

        .nav-pills li a:hover {
            color: black !important;
        }

    .nav-pills > li.active > a, .nav-pills > li.active > a:hover, .nav-pills > li.active > a:focus {
        background-color: rgba(0,0,0,.2) !important;
    }
</style>
<script>
    var oTable;
    var oTable2;
    $(document).ready(function () {
        LoadData();
        BindCharts();
        LoadLocations();
        $("#Ftxtfromdate").datepicker({
            changeMonth: true,
            changeYear: true,
            Edit: true,
            dateFormat: "dd/mm/yy",
            yearRange: "-30:+30",
            onSelect: function (dateText, inst) {
                $("#Ftxttodate").datepicker("option", "minDate",
                    $("#Ftxtfromdate").datepicker("getDate"));
            }
        });
        $("#Ftxttodate").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: "dd/mm/yy",
            yearRange: "-30:+30",
            Edit: true
        });
        $("#FtxtfromdateAll").datepicker({
            changeMonth: true,
            changeYear: true,
            Edit: true,
            dateFormat: "dd/mm/yy",
            yearRange: "-30:+30",
            onSelect: function (dateText, inst) {
                $("#FtxttodateAll").datepicker("option", "minDate",
                    $("#FtxtfromdateAll").datepicker("getDate"));
            }
        });
        $("#FtxttodateAll").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: "dd/mm/yy",
            yearRange: "-30:+30",
            Edit: true
        });
    });
    function LoadData() {
        oTable = $('#tblManageTaskApprovers').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/Cpx/AjaxbyCpxDetails",
            "bProcessing": true,
            "bDestroy": true,
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, -1], [10, 20, 30, 50, 100, 150, 200, "All"]],
            "aoColumns": [
                { "sName": "TaskCpxId" },
                { "sName": "Type" },
                { "sName": "RelatedTo" },
                { "sName": "CreatedDate" },
                { "sName": "CreatorLocationName" },
                //{ "sName": "CreatorDepartmentName" },
                { "sName": "CreatorName" },
                { "sName": "ProjectTitle" },
                { "sName": "ReqDept" },
                { "sName": "Item" },
                { "sName": "Qty" },
                { "sName": "EstimatedCost" },
                { "sName": "Budgeted" },
                { "sName": "IsNewItem" },
                { "sName": "Priority" },
                { "sName": "CpxStatus" },
                {
                    "sName": "TaskCpxId",
                    "bSortable": false,
                    "render": function (data) {
                        return GetHtmlContent(data);

                    }
                }
            ],
            "fnServerParams": function (aoData) {
                aoData.push(
                    { "name": "fromdate", "value": $("#Ftxtfromdate").val() },
                    { "name": "todate", "value": $("#Ftxttodate").val() },
                    { "name": "locationid", "value": $("#LocationIdfilter").val() },
                    { "name": "departmentid", "value": $("#DepartmentIdfilter").val() },
                    { "name": "category", "value": $("#CPXRelatedTo").val() }
                );
            },
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                $('td:eq(0)', nRow).html('<a href="javascript:void(0);" id="' + aData[0] + '" title="View Details" onclick="ViewTaskDetails(this.id);">' + aData[0] + '</a>')
                $('td:eq(8)', nRow).html('<a href="javascript:void(0);" id="' + aData[0] + '" title="View Details" onclick="ViewTaskDetails(this.id);">' + aData[8] + '</a>');

                switch (aData[14]) {
                    case 'Pending':
                    case 'Pending at Requestor':
                        $('td:eq(14)', nRow).css('color', '#E67D21');
                        break;
                    case 'New':
                        $('td:eq(14)', nRow).css('color', '#3598dc');
                        break;
                    case 'In Progress':
                        $('td:eq(14)', nRow).css('color', '#8E44AD');
                        break;
                    case 'Reopen':
                        $('td:eq(14)', nRow).css('color', '#5FC29D');
                        break;
                    case 'Rejected':
                        $('td:eq(14)', nRow).css('color', '#a71f23');
                        break;
                    default:
                        $('td:eq(14)', nRow).css('color', 'Green');
                        break;
                }
                switch (aData[11]) {
                    case 'No':
                        $('td:eq(11)', nRow).css('color', '#a71f23');
                        break;
                    default:
                        $('td:eq(11)', nRow).css('color', 'Green');
                        break;
                }
            }
        });
        $("#tblManageTaskApprovers_length").addClass("col-md-6");
        $("#tblManageTaskApprovers_length").append("<a href='/CPX/ExportExcel_CPX' target='_blank'>&nbsp;  Download</a>");

        oTable2 = $('#tblManageTaskApproversAll').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/Cpx/AjaxbyCpxDetailsAll",
            "bProcessing": true,
            "bDestroy": true,
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, -1], [10, 20, 30, 50, 100, 150, 200, "All"]],
            "aoColumns": [
                { "sName": "TaskCpxId" },
                { "sName": "Type" },
                { "sName": "RelatedTo" },
                { "sName": "CreatedDate" },
                { "sName": "CreatorLocationName" },
                //{ "sName": "CreatorDepartmentName" },
                { "sName": "CreatorName" },
                { "sName": "ProjectTitle" },
                { "sName": "ReqDept" },
                { "sName": "Item" },
                { "sName": "Qty" },
                { "sName": "EstimatedCost" },
                { "sName": "Budgeted" },
                { "sName": "IsNewItem" },
                { "sName": "Priority" },
                { "sName": "CpxStatus" },
                { "sName": "CurrentApprover" },
                {
                    "sName": "TaskCpxId",
                    "bSortable": false,
                    "render": function (data) {
                        return GetHtmlContent(data);

                    }
                }
            ],
            "fnServerParams": function (aoData) {
                aoData.push(
                    { "name": "fromdate", "value": $("#FtxtfromdateAll").val() },
                    { "name": "todate", "value": $("#FtxttodateAll").val() },
                    { "name": "locationid", "value": $("#LocationIdfilterAll").val() },
                    { "name": "departmentid", "value": $("#DepartmentIdfilterAll").val() },
                    { "name": "category", "value": $("#CPXRelatedTo2").val() },
                    { "name": "categoryid", "value": $("#ddlApproverLevel").val() },
                    
                );
            },
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                $('td:eq(0)', nRow).html('<a href="javascript:void(0);" id="' + aData[0] + '" title="View Details" onclick="ViewTaskDetails(this.id);">' + aData[0] + '</a>')
                $('td:eq(8)', nRow).html('<a href="javascript:void(0);" id="' + aData[0] + '" title="View Details" onclick="ViewTaskDetails(this.id);">' + aData[8] + '</a>');

                switch (aData[14]) {
                    case 'Pending':
                    case 'Pending at Requestor':
                        $('td:eq(14)', nRow).css('color', '#E67D21');
                        break;
                    case 'New':
                        $('td:eq(14)', nRow).css('color', '#3598dc');
                        break;
                    case 'In Progress':
                        $('td:eq(14)', nRow).css('color', '#8E44AD');
                        break;
                    case 'Reopen':
                        $('td:eq(14)', nRow).css('color', '#5FC29D');
                        break;
                    case 'Rejected':
                        $('td:eq(14)', nRow).css('color', '#a71f23');
                        break;
                    default:
                        $('td:eq(14)', nRow).css('color', 'Green');
                        break;
                }
                switch (aData[11]) {
                    case 'No':
                        $('td:eq(11)', nRow).css('color', '#a71f23');
                        break;
                    default:
                        $('td:eq(11)', nRow).css('color', 'Green');
                        break;
                }
            }
        });
    }

    function GetHtmlContent(data) {

        var htmlcontect = "";
        htmlcontect += '<div class="btn-group">';
        htmlcontect += '<div class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-th-list"></span></div>';
        htmlcontect += '<ul class="dropdown-menu dropdown-menu-right">';
        htmlcontect += '<li class="dontScoll"><a href="javascript:void(0);" id="' + data + '" onclick="ViewTaskDetails(this.id);">View Task</a></li>';
        htmlcontect += '<li><a href="javascript:void(0);" id="' + data + '" onclick="DoneTaks(this.id);"> Close</a></li> ';
        htmlcontect += '<li><a href="javascript:void(0);" id="' + data + '" onclick="ApproveTask(this.id);">Accept</a></li>';
        htmlcontect += '<li><a href="javascript:void(0);" id="' + data + '" onclick="CancelRequest(this.id);">Reject</a></li>';
        htmlcontect += '<li><a href="javascript:void(0);" id="' + data + '" onclick="ViewApprovers(this.id);">View Approvers</a></li> ';
        //htmlcontect += '<li><a href="javascript:void(0);" id="' + data + '" onclick="WorkDonwstatus(this.id);">WorkDone Comments</a></li> ';
        htmlcontect += '<li><a href="javascript:void(0);" id="' + data + '" onclick="ViewFiles(this.id);">View Files</a></li>';
        htmlcontect += '<li><a href="/Cpx/PrintCPX/' + data + '" id="' + data + '" target="_blank">Print</a></li>';
        htmlcontect += '<li><a href="/Cpx/ManageCPXApprovers/' + data + '" id="' + data + '" target="_blank">Manage Approvers</a></li>';
        htmlcontect += '</ul></div>';
        return htmlcontect;
    }
    function ViewTaskDetails(id) {
        var html = "";
        $.get("/Cpx/GetFullDetailsOfCpx?id=" + id, function (data) {
            html = "<table class='table table-bordered table-striped'>";
            html += "<tr><td>Type</td><td>" + data.CPXType + "</td></tr>";
            var item = "Item"; var company = "";
            if (data.CPXType == "CPX") {
                item = "Item";
                company = "";
            }
            else if (data.CPXType == "AMC/CMC") {
                item = "AMC Item";
                company = "AMC Company";
            }
            else if (data.CPXType == "Repair") {
                item = "Repair Item";
                company = "Repair Company";
            }
            else if (data.CPXType == "Replacement") {
                item = "Replacement Item";
                company = "Replacement Company";
            }
            html += "<tr><td>CPX Date</td><td>" + data.CreatedDate + "</td></tr>";
            html += "<tr><td>Project Title</td><td>" + data.ProjectTitle + "</td></tr>";
            html += "<tr><td>Qty</td><td>" + data.Qty + "</td></tr>";
            html += "<tr><td>Budgeted</td><td>" + data.Budgeted + "</td></tr>";
            html += "<tr><td>Creator</td><td>" + data.CreatorLocationName + " " + data.CreatorDepartmentName + " " + data.CreatorName + "</td></tr>";
            //html += "<tr><td>Creator Department</td><td>" + data.CreatorDepartmentName + "</td></tr>";
            //html += "<tr><td>Creator </td><td>" + data.CreatorName + "</td></tr>";
            html += "<tr><td>Estimated Cost</td><td>" + data.EstimatedCost + "</td></tr>";
            html += "<tr><td>Cpx Related To</td><td>" + data.CpxRelatedTo + "</td></tr>";
            html += "<tr><td>Cpx Status</td><td>" + data.CpxStatus + "</td></tr>";
            html += "<tr><td>" + item + "</td><td>" + data.Item + "</td></tr>";
            if (data.IsNewItem == "Yes") {
                html += "<tr><td>Is New Item</td><td>" + data.IsNewItem + "</td></tr>";
            } else {
                html += "<tr><td>Is Repeat Item</td><td>Yes</td></tr>";
            }
            html += "<tr><td>Item Details</td><td>" + data.ItemDetails + "</td></tr>";
            html += "<tr><td>Main Features</td><td>" + data.MainFeatures + "</td></tr>";
            html += "<tr><td>Model</td><td>" + data.Model + "</td></tr>";
            html += "<tr><td>Priority</td><td>" + data.Priority + "</td></tr>";
            html += "<tr><td>Request For Department</td><td>" + data.RequestForDepartment + "</td></tr>";
            html += "<tr><td>Work Done Comments</td><td>" + data.WorkDoneComments + "</td></tr>";
            if (data.CPXType != "CAPX" && data.CPXType != "CPX")
                html += "<tr><td>" + company + "</td><td>" + data.SupportCompany + "</td></tr>";
            if (data.CPXType == "AMC/CMC") {
                html += "<tr><td>Last Renewal Date</td><td>" + data.AMCLastRenewalDate + "</td></tr>";
                html += "<tr><td>Next Renewal Date</td><td>" + data.AMCNextRenewalDate + "</td></tr>";
            } else if (data.CPXType == "Replacement") {
                html += "<tr><td>Replacement Reason</td><td>" + data.ReasonForReplacement + "</td></tr>";
                html += "<tr><td>Existing Product Model</td><td>" + data.OldProductModel + "</td></tr>";
                html += "<tr><td>Old Product Cost</td><td>" + data.OldProductCost + "</td></tr>";
            }
            else if (data.CPXType == "Repair") {
            }
            html += "</table>";
            $("#divfullrequestdetails").html(html);
            $("#myModalFullrequest").modal("show");
        });

    }

    function ViewApprovers(id) {
        var html = "";
        $.get("/Cpx/GetFullDetailsOfCpx?id=" + id, function (maindata) {

            var item = "Item";
            if (maindata.CPXType == "CPX" || maindata.CPXType == "CAPX") {
                item = "Item";
            }
            else if (maindata.CPXType == "AMC/CMC") {
                item = "AMC Item";
            }
            else if (maindata.CPXType == "Repair") {
                item = "Repair Item";
            }
            else if (maindata.CPXType == "Replacement") {
                item = "Replacement Item";
            }
            $.get("/Cpx/GetApproversList?id=" + id, function (data) {
                html = "<p><b>" + item + " :</b> " + maindata.Item + "<br /><b>Item Details :</b>" + maindata.ItemDetails + " </p><br><table class='table table-bordered table-striped'>";

                html += "<tr><td style='display:none;'>Department</td><td>Approver </td><td>Approval Level</td><td>Is Approved</td><td>Approved Date</td><td>Approve Comments</td></tr>";
                for (var i = 0; i < data.length; i++) {
                    html += "<tr><td style='display:none;'>" + data[i].DepartmentName + "</td>";
                    html += "<td>" + data[i].FirstName + "</td>";
                    var name = '';
                    switch (data[i].ApprovalLevel) {
                        case "-1":
                            name = 'Incharge';
                            break;
                        case "0":
                            name = 'HOD';
                            break;
                        case "1":
                            name = 'Technical Admin';
                            break;
                        case "2":
                            name = 'Unit Admin';
                            break;
                        case "3":
                            name = 'Medial Director';
                            break;
                        case "4":
                            name = 'Finance Approve';
                            break;
                        case "5":
                            name = 'Final Approver 1';
                            break;
                        case "6":
                            name = 'Final Approver 2';
                            break;
                        case "7":
                            name = 'Final Approver 3';
                            break;
                        case "8":
                            name = 'Purchase Approver 1';
                            break;
                        case "9":
                            name = 'Purchase Approver 2';
                            break;
                    }
                    html += "<td>" + name + "</td>";
                    if (data[i].IsApproved) {
                        html += "<td>Yes</td>";
                    } else {
                        html += "<td>No</td>";
                    }
                    html += "<td>" + data[i].ApprovedDate + "</td>";
                    html += "<td>" + data[i].ApproveComments + "</td></tr>";
                }
                html += "</table>";
                $("#divfullapproversdetails").html(html);
                $("#myModalViewApprovers").modal("show");

            });
        });
    }
    var currentrequestid;
    function CancelRequest(id) {
        currentrequestid = id;

        $("#myModalRejectrequest").modal("show");
    }
    function DoneTaks(id) {
        $("#myModalWorkDone").modal("show");
        currentrequestid = id;
        //if (confirm("Are you sure you want to close?")) {
        //    $.get("/Cpx/CloseCpxRequestByPurchase?id=" + id + "&comments=close", function (data) {
        //        LoadData();
        //    });
        //}
    }
    function CloseCpxRequest() {
        $.get("/Cpx/CloseCpxRequestByPurchase?id=" + currentrequestid + "&comments=" + $("#txtcommentsWorkDone").val(), function (data) {
            $("#myModalWorkDone").modal("hide");
            oTable.api().ajax.reload(null, false);
            oTable2.api().ajax.reload(null, false);
        });
    }
    function ApproveTask(id) {
        currentrequestid = id;
        $("#myModalApproverequest").modal("show");
    }
    function ApproveCpxRequest() {
        $.get("/Cpx/ApproveCpxRequestByPurchase?id=" + currentrequestid + "&comments=" + $("#txtcommentsapprove").val(), function (data) {
            oTable.api().ajax.reload(null, false);
            oTable2.api().ajax.reload(null, false);
            $("#myModalApproverequest").modal("hide");
        });
    }
    function RejectCpxRequest() {
        $.get("/Cpx/RejectCpxRequest?id=" + currentrequestid + "&comments=" + $("#txtcommentsreject").val(), function (data) {
            oTable.api().ajax.reload(null, false);
            oTable2.api().ajax.reload(null, false);
            $("#myModalRejectrequest").modal("hide");
        });
    }

    var currentid;
    function ViewFiles(id) {
        currentid = id;
        //alert(id);
        BindListoffiles(id);
        $("#divManageDocuments").modal("show");
    }
    function Uploaddataclick() {

        // Checking whether FormData is available in browser
        if (window.FormData !== undefined) {

            var fileUpload = $("#selectfiletoupload").get(0);
            var files = fileUpload.files;

            // Create FormData object
            var fileData = new FormData();

            // Looping over all files and add it to FormData object
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }

            // Adding one more key to FormData object
            fileData.append('id', currentid);
            fileData.append('public', $("#documentisprivate").val());
            $.ajax({
                url: '/Cpx/UploadFiles',
                type: "POST",
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: fileData,
                success: function (result) {
                    alert(result);
                    BindListoffiles(currentid);
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        } else {
            alert("FormData is not supported.");
        }
    }
    function BindListoffiles(id) {
        $.get("/Cpx/GetListOfFiles", { id: id }, function (data) {
            var html = "<table class='table  table-bordered'><tr style='background-color:teal;color:white;'><td>Name</td><td> Action</td></tr>";
            for (var i = 0; i < data.length; i++) {
                html += "<tr><td>" + data[i].DocumentName + "</td><td><a  target='_blank' href='/ExcelUplodes/" + data[i].DocumentPath + "'>View</a> </td></tr>";
            }
            html + "</table>";
            $("#Divdocumentshistory").html(html);
        });
    }
    function BindCharts() {
        $.get("/CPX/GetCpxCountByCpxRelatedTo", function (data) {
            var dataforchart = [];
            var categoriesx = [];
            for (var i = 0; i < data.length; i++) {
                var localarray = [];
                categoriesx.push(data[i].Key);
                localarray.push(data[i].Key);
                localarray.push(data[i].Count);
                dataforchart.push(localarray)
            }
            Highcharts.chart('container', {
                chart: {
                    type: 'cylinder',
                    options3d: {
                        enabled: true,
                        alpha: 15,
                        beta: 15,
                        depth: 50,
                        viewDistance: 25
                    }
                },
                title: {
                    text: 'CPX Related TO'
                },
                xAxis: {
                    categories: categoriesx,
                    crosshair: true
                },
                plotOptions: {
                    series: {
                        depth: 25,
                        colorByPoint: true
                    }
                },
                series: [{
                    data: dataforchart,
                    name: 'Related',
                    showInLegend: true
                }]
            });
        });
        $.get("/CPX/GetCpxCountByRequestForTheDepartment", function (data) {
            var dataforchart2 = [];
            for (var i = 0; i < data.length; i++) {
                var localarray = [];
                localarray.push(data[i].Key);
                localarray.push(data[i].Count);
                dataforchart2.push({
                    name: data[i].Key,
                    y: data[i].Count
                });
            }

            Highcharts.chart('container1', {
                chart: {
                    type: 'pie',
                    options3d: {
                        enabled: true,
                        alpha: 45,
                        beta: 0
                    }
                },
                title: {
                    text: 'Request For the Department'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        depth: 35,
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}'
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Department',
                    data: dataforchart2
                }]
            });
        });
        $.get("/CPX/GetCpxCountByProjectTitle", function (data) {
            var dataforchart1 = [];
            var categoriesx = [];
            for (var i = 0; i < data.length; i++) {
                var localarray = [];
                categoriesx.push(data[i].Key);
                localarray.push(data[i].Key);
                localarray.push(data[i].Count);
                dataforchart1.push(localarray)
            }
            Highcharts.chart('container2', {
                chart: {
                    type: 'cylinder',
                    options3d: {
                        enabled: true,
                        alpha: 15,
                        beta: 15,
                        depth: 50,
                        viewDistance: 25
                    }
                },
                title: {
                    text: 'Project Title'
                },
                xAxis: {
                    categories: categoriesx,
                    crosshair: true
                },
                plotOptions: {
                    series: {
                        depth: 25,
                        colorByPoint: true
                    }
                },
                series: [{
                    data: dataforchart1,
                    name: 'Count',
                    showInLegend: true
                }]
            });
        });
    }
    function LoadLocations() {
        $.ajax({
            type: "POST",
            url: "/Common/GetLocations",
            //data: "id=",
            success: function (data) {
                var options = [];
                options.push('<option value="">- Select Location -</option>');
                for (var i = 0; i < data.length; i++) {
                    options.push('<option value="' + data[i].LocationId + '">' + data[i].LocationName + '</option>');
                }
                $("#LocationIdfilterAll").html(options.join(''));
                $("#LocationIdfilter").html(options.join(''));
            },
            error: function () {
                alert("error")
            }
        });
    }
    function LoadDepartment() {
        var options = [];
        options.push('<option value="">- Select Department -</option>');
        if ($("#LocationIdfilter").val() != "") {
            $.ajax({
                type: "POST",
                url: "/Common/GetDepartmentByLocation",
                data: "id=" + $("#LocationIdfilter").val(),
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        options.push('<option value="' + data[i].DepartmentId + '">' + data[i].DepartmentName + '</option>');
                    }
                    $("#DepartmentIdfilter").html(options.join(''));

                },
                error: function () {
                    alert("error")
                }
            });
        }
        else {
            $("#DepartmentIdfilter").html(options.join(''));
        }

    }
    function ExportToExcel() {
        validateDate();

        if (validate) {
            var id = 0;
            FromDate = $("#Ftxtfromdate").val();
            ToDate = $("#Ftxttodate").val();
            var type = "approve";
            var url = '/Cpx/ExportExcelCPX?FromDate=' + FromDate + '&ToDate=' + ToDate + '&type=' + type;
            if ($("#LocationIdfilter").val() != null && $("#LocationIdfilter").val() != "")
                url += '&locationId=' + $("#LocationIdfilter").val();
            if ($("#DepartmentIdfilter").val() != null && $("#DepartmentIdfilter").val() != "")
                url += '&departmentId=' + $("#DepartmentIdfilter").val();
            window.location = url;
            $("#Ftxtfromdate").val("");
            $("#Ftxttodate").val("");
        }
    }
    function ExportToExcel2() {
        validateDate();

        if (validate) {
            var id = 0;
            FromDate = $("#Ftxtfromdate").val();
            ToDate = $("#Ftxttodate").val();
            var type = "approve";
            var url = '/Cpx/ExportExcelCPXReport?FromDate=' + FromDate + '&ToDate=' + ToDate + '&type=' + type;
            if ($("#LocationIdfilter").val() != null && $("#LocationIdfilter").val() != "")
                url += '&locationId=' + $("#LocationIdfilter").val();
            if ($("#DepartmentIdfilter").val() != null && $("#DepartmentIdfilter").val() != "")
                url += '&departmentId=' + $("#DepartmentIdfilter").val();
            window.location = url;
            $("#Ftxtfromdate").val("");
            $("#Ftxttodate").val("");
        }
    }


    function validateDate() {

        validate = true;
        $(".css-error").removeClass('css-error');
        if ($("#Ftxtfromdate").val() == "") {
            $("#Ftxtfromdate").addClass('css-error');
            validate = false;
        }
        if ($("#Ftxttodate").val() == "") {
            $("#Ftxttodate").addClass('css-error');
            validate = false;
        }
    }
    function LoadDepartmentAll() {
        var options = [];
        options.push('<option value="">- Select Department -</option>');
        if ($("#LocationIdfilterAll").val() != "") {
            $.ajax({
                type: "POST",
                url: "/Common/GetDepartmentByLocation",
                data: "id=" + $("#LocationIdfilterAll").val(),
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        options.push('<option value="' + data[i].DepartmentId + '">' + data[i].DepartmentName + '</option>');
                    }
                    $("#DepartmentIdfilterAll").html(options.join(''));

                },
                error: function () {
                    alert("error")
                }
            });
        }
        else {
            $("#DepartmentIdfilterAll").html(options.join(''));
        }

    }
    function ExportToExcelAll() {
        validateDateAll();

        if (validate) {
            var id = 0;
            FromDate = $("#FtxtfromdateAll").val();
            ToDate = $("#FtxttodateAll").val();
            var type = "All";
            var url = '/Cpx/ExportExcelCPX?FromDate=' + FromDate + '&ToDate=' + ToDate + '&type=' + type;
            if ($("#LocationIdfilterAll").val() != null && $("#LocationIdfilterAll").val() != "")
                url += '&locationId=' + $("#LocationIdfilterAll").val();
            if ($("#DepartmentIdfilterAll").val() != null && $("#DepartmentIdfilterAll").val() != "")
                url += '&departmentId=' + $("#DepartmentIdfilterAll").val();
            window.location = url;
            $("#FtxtfromdateAll").val("");
            $("#FtxttodateAll").val("");
        }
    }

    function validateDateAll() {

        validate = true;
        $(".css-error").removeClass('css-error');
        if ($("#FtxtfromdateAll").val() == "") {
            $("#FtxtfromdateAll").addClass('css-error');
            validate = false;
        }
        if ($("#FtxttodateAll").val() == "") {
            $("#FtxttodateAll").addClass('css-error');
            validate = false;
        }
    }
</script>
<div class="modal fade" id="myModalWorkDone" role="dialog">
    <div class="form-block">
        <h3>Work Done Remarks<button type="button" class="pull-right close" data-dismiss="modal">&times;</button></h3>
        <div id="divapproverequest">
            <table class="table" style="width:100%;">
                <tr>
                    <td>
                        Remarks
                    </td>
                    <td>
                        <textarea id="txtcommentsWorkDone" class="form-control"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;
                    </td>
                    <td>
                        <input type="button" id="btnapprove11" class="btn btn-warning" onclick="CloseCpxRequest();" value="Update Comments" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<div class="bs-example bs-example-tabs" data-example-id="togglable-tabs">
    <ul class="nav nav-tabs" id="myTabs" role="tablist">
        <li role="presentation" class="active">
            <a href="#home" id="home-tab" role="tab" data-toggle="tab" aria-controls="home" aria-expanded="true"><span class="glyphicon glyphicon-arrow-right"></span>&nbsp;Manage CPX</a>
        </li>
        <li role="presentation" class="">
            <a href="#profile" role="tab" id="profile-tab" data-toggle="tab" aria-controls="profile" aria-expanded="false">All CPX</a>
        </li>

    </ul>
    <div class="tab-content" id="myTabContent" style="padding:10px;">
        <div class="tab-pane fade active in" role="tabpanel" id="home" aria-labelledby="home-tab">
            <div class="row">
                <div class="col-xl-3 col-lg-3 col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="media align-items-stretch">
                                <div class="p-2 text-center bg-primary bg-darken-2">
                                    <i class="glyphicon glyphicon-th-list font-large-2 white"></i>
                                </div>
                                <div class="p-2 bg-gradient-x-primary white media-body">
                                    <h5>Total Cpxs</h5>
                                    <h5 class="text-bold-400 mb-0">@ViewBag.TotalCpxs</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="media align-items-stretch">
                                <div class="p-2 text-center bg-danger bg-darken-2">
                                    <i class="glyphicon glyphicon-thumbs-up font-large-2 white"></i>
                                </div>
                                <div class="p-2 bg-gradient-x-danger white media-body">
                                    <h5>Total Approved</h5>
                                    <h5 class="text-bold-400 mb-0">@ViewBag.TotalApproved</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="media align-items-stretch">
                                <div class="p-2 text-center bg-warning bg-darken-2">
                                    <i class="glyphicon glyphicon-ok font-large-2 white"></i>
                                </div>
                                <div class="p-2 bg-gradient-x-warning white media-body">
                                    <h5>Total Closed</h5>
                                    <h5 class="text-bold-400 mb-0">@ViewBag.TotalClosed</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="media align-items-stretch">
                                <div class="p-2 text-center bg-success bg-darken-2">
                                    <i class="glyphicon glyphicon-info-sign font-large-2 white"></i>
                                </div>
                                <div class="p-2 bg-gradient-x-success white media-body">
                                    <h5>In Progress</h5>
                                    <h5 class="text-bold-400 mb-0">@ViewBag.TotalInProgress</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-2">
                    <select class="form-control maxwidth" id="LocationIdfilter" onchange="LoadDepartment();"><option value="">- Select Location -</option></select>
                </div>
                <div class="col-md-2">
                    <select class="form-control maxwidth" id="DepartmentIdfilter">
                        <option value="">- Select Department -</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-control clsrequired" id="CPXRelatedTo">
                        <option value="">Select RelatedTo</option>
                        <option value="IT">IT</option>
                        <option value="Biomedical">Biomedical</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Maintenance Renovation">Maintenance Renovation</option>
                        <option value="Pharmacy">Pharmacy</option>
                        <option value="Food & Beverage">Food & Beverage</option>
                        <option value="Brand & Communication">Brand & Communication</option>
                        <option value="Security and Transport">Security and Transport</option>
                        <option value="House Keeping">House Keeping</option>
                        <option value="HICC">HICC</option>
                        <option value="Purchase">Purchase</option>
                        <option value="OT-OBS">OT-OBS</option>
                        <option value="OT-GYN">OT-GYN</option>
                        <option value="OT-Others">OT-Others</option>
                    </select>
                </div>
                <div class="form-group col-md-1">
                    <input type="text" class="form-control" autocomplete="off" placeholder="From Date" id="Ftxtfromdate" />
                </div>
                <div class="form-group col-md-1">
                    <input type="text" class="form-control" autocomplete="off" placeholder="To Date" id="Ftxttodate" />
                </div>
                <div class="form-group col-md-3">
                    <button type="button" class="btn btn-sm btn-default" value="Export To Excel" onclick="ExportToExcel();"><span class="glyphicon glyphicon-download" style="vertical-align:middle;"></span>&nbsp;Export To Excel</button>
                    <button type="button" class="btn btn-sm btn-success" value="Go" onclick="LoadData();"><span class="glyphicon glyphicon-search" style="vertical-align:middle;"></span>&nbsp;Go</button>
                    <button type="button" class="btn btn-sm btn-default" value="Excel Report" onclick="ExportToExcel2();"><span class="glyphicon glyphicon-download" style="vertical-align:middle;"></span>&nbsp;Export To Report</button>
                </div>
            </div>
            <table class="table table-bordered" id="tblManageTaskApprovers">
                <thead>
                    <tr style="background-color: #786C67;color: white;">
                        <th>Cpx No.</th>
                        <th>Type</th>
                        <th>Related To</th>
                        <th>Cpx Date</th>
                        <th>Location- Dept</th>
                        <th>User</th>
                        <th>Project</th>
                        <th>Req Department</th>
                        <th>Item</th>
                        <th>Qty</th>
                        <th>Estimated Cost</th>
                        <th>Budgeted</th>
                        <th>Is New Item</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <br />
            <div class="row">
                <div class="col-xl-3 col-lg-3 col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="media align-items-stretch">
                                <div class="p-2 text-center bg-primary">
                                    <i class="glyphicon glyphicon-th-list font-large-2 white"></i>
                                </div>
                                <div class="p-2 bg-primary white media-body">
                                    <h5>Total Estimated Cost</h5>
                                    <h5 class="text-bold-400 mb-0">@ViewBag.TotalEstimatedCost</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="media align-items-stretch">
                                <div class="p-2 text-center bg-danger">
                                    <i class="glyphicon glyphicon-info-sign font-large-2 white"></i>
                                </div>
                                <div class="p-2 bg-danger white media-body">
                                    <h5>Priority Vital</h5>
                                    <h5 class="text-bold-400 mb-0">@ViewBag.TotalPriorityVital</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="media align-items-stretch">
                                <div class="p-2 text-center bg-warning">
                                    <i class="glyphicon glyphicon-info-sign font-large-2 white"></i>
                                </div>
                                <div class="p-2 bg-warning white media-body">
                                    <h5>Priority Essential</h5>
                                    <h5 class="text-bold-400 mb-0">@ViewBag.TotalPriorityEssential</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="media align-items-stretch">
                                <div class="p-2 text-center bg-success">
                                    <i class="glyphicon glyphicon-info-sign font-large-2 white"></i>
                                </div>
                                <div class="p-2 bg-success white media-body">
                                    <h5>Priority Desirable</h5>
                                    <h5 class="text-bold-400 mb-0">@ViewBag.TotalPriorityDesirable</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="row">
                <div class="col-md-6" style="border: solid 5px lightsteelblue;">
                    <div id="container">

                    </div>
                </div>
                <div class="col-md-6" style="border: solid 5px lightsteelblue;">
                    <div id="container2">

                    </div>
                </div>
                <div class="col-md-12" style="border: solid 5px lightsteelblue;">
                    <div id="container1">

                    </div>
                </div>
            </div>

            <br />
        </div>
        <div class="tab-pane fade" role="tabpanel" id="profile" aria-labelledby="profile-tab">
            <div class="form-row">
                <div class="col-md-2">
                    <select class="form-control maxwidth" id="LocationIdfilterAll" onchange="LoadDepartmentAll();"><option value="">- Select Location -</option></select>
                </div>
                <div class="col-md-2">
                    <select class="form-control maxwidth" id="DepartmentIdfilterAll">
                        <option value="">- Select Department -</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-control clsrequired" id="CPXRelatedTo2">
                        <option value="">Select RelatedTo</option>
                        <option value="IT">IT</option>
                        <option value="Biomedical">Biomedical</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Maintenance Renovation">Maintenance Renovation</option>
                        <option value="Pharmacy">Pharmacy</option>
                        <option value="Food & Beverage">Food & Beverage</option>
                        <option value="Brand & Communication">Brand & Communication</option>
                        <option value="Security and Transport">Security and Transport</option>
                        <option value="House Keeping">House Keeping</option>
                        <option value="HICC">HICC</option>
                        <option value="Purchase">Purchase</option>
                        <option value="OT-OBS">OT-OBS</option>
                        <option value="OT-GYN">OT-GYN</option>
                        <option value="OT-Others">OT-Others</option>
                    </select>
                </div>
                <div class="form-group col-md-1">
                    <input type="text" class="form-control" autocomplete="off" placeholder="From Date" id="FtxtfromdateAll" />
                </div>
                <div class="form-group col-md-1">
                    <input type="text" class="form-control" autocomplete="off" placeholder="To Date" id="FtxttodateAll" />
                </div>
                <div class="col-md-2">
                    <select id="ddlApproverLevel" class="form-control">
                        <option value="0">Select Approver Level</option>
                        <option value="-1">Incharge</option>
                        <option value="1">Technical Admin</option>
                        <option value="2">Unit Admin</option>
                        <option value="3">Medial Director</option>
                        <option value="4">Finance Approve</option>
                        <option value="5">Rahul Dutta</option>
                        <option value="6">Dr Pramod</option>                      
                        <option value="8">Veerababu K</option>
                        <option value="9">Purchase</option>
                    </select>
                </div>
                <div class="form-group col-md-2">
                    <button type="button" class="btn btn-sm btn-default" value="Export To Excel" onclick="ExportToExcelAll();"><span class="glyphicon glyphicon-download" style="vertical-align:middle;"></span>&nbsp;Export To Excel</button>
                    <button type="button" class="btn btn-sm btn-success" value="Go" onclick="LoadData();"><span class="glyphicon glyphicon-search" style="vertical-align:middle;"></span>&nbsp;Go</button>
                </div>
            </div>
            <table class="table table-bordered" id="tblManageTaskApproversAll" style="width:100%;">
                <thead>
                    <tr style="background-color: #786C67;color: white;">
                        <th>Cpx No.</th>
                        <th>Type</th>
                        <th>Related To</th>
                        <th>CPX Date</th>
                        <th>Location - Dept</th>
                        <th>User</th>
                        <th>Project</th>
                        <th>Req Department</th>
                        <th>Item</th>
                        <th>Qty</th>
                        <th>Estimated Cost</th>
                        <th class="none">Budgeted</th>
                        <th class="none">Is New Item</th>
                        <th class="none">Priority</th>
                        <th>Status</th>
                        <th>Current Approver</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>


<div class="modal fade" id="myModalRejectrequest" role="dialog">
    <div class="form-block">
        <h3>Reject Request<button type="button" class="pull-right close" data-dismiss="modal">&times;</button></h3>
        <div id="divapproverequesst">
            <table class="table" style="width:100%;">
                <tr>
                    <td>
                        Comments
                    </td>
                    <td>
                        <textarea id="txtcommentsreject" class="form-control"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;
                    </td>
                    <td>
                        <input type="button" id="btnapprove" class="btn btn-danger" onclick="RejectCpxRequest();" value="Reject" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<div class="modal fade" id="myModalApproverequest" role="dialog">
    <div class="form-block">
        <h3>Approve Request<button type="button" class="pull-right close" data-dismiss="modal">&times;</button></h3>
        <div id="divapproverequest">
            <table class="table" style="width:100%;">
                <tr>
                    <td>
                        Comments
                    </td>
                    <td>
                        <textarea id="txtcommentsapprove" class="form-control"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;
                    </td>
                    <td>
                        <input type="button" id="btnapprove" class="btn btn-warning" onclick="ApproveCpxRequest();" value="Approve" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="myModalFullrequest" role="dialog">
    <div class="form-block">
        <h3>View Request<button type="button" class="pull-right close" data-dismiss="modal">&times;</button></h3>
        <div id="divfullrequestdetails">

        </div>
    </div>
</div>

<div class="modal fade" id="myModalViewApprovers" role="dialog">
    <div class="form-block">
        <h3>View Approvers<button type="button" class="pull-right close" data-dismiss="modal">&times;</button></h3>

        <div id="divfullapproversdetails">

        </div>
    </div>
</div>

<div id="divManageDocuments" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Manage Documents</h4>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <td>
                            Is It Private :
                        </td>
                        <td>
                            <input type="checkbox" id="documentisprivate" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Select File  :
                        </td>
                        <td>
                            <input type="file" name="file" id="selectfiletoupload" multiple />
                        </td>
                        <td>
                            <input type="button" id="btnUploadfile" class="btn btn-primary" value="Upload" onclick="Uploaddataclick();" />
                        </td>
                    </tr>
                </table>
                <div class="row" style="padding:5px;" id="Divdocumentshistory">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>