@{
    ViewBag.Title = "ManageLocation";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">Manage Location </div>
            <div class="panel-body">
                <div class="col-lg-12" style="padding:2%;">
                    <div class="col-xs-1">
                        <label for="name">Location Name</label>
                    </div>
                    <div class="col-xs-3">
                        <input type="text" name="name" id="txtlocation" class="form-control" />
                        <input type="hidden" name="name" id="hdnlocationId" />
                    </div>
                    <div class="col-md-2">
                        <input type="checkbox" id="ShowinCPX" />Show In CPX
                    </div>
                    <div class="col-md-2">
                        <input type="checkbox" id="ShowasSubLocation" />Show as SubLocation
                    </div>
                    <div class="col-md-2">
                        <select id="ddlLocation" class="form-control"></select>
                    </div>
                    <div class="col-xs-2">
                        <input type="button" name="name" value="Submit" class="btn btn-primary" onclick="SubmitForm()" />
                        <input type="button" name="name" value="Cancel" class="btn btn-danger" onclick="clearAll()" />
                    </div>
                </div>

                <div class="col-lg-12" style="padding:1%;border-top:1px solid #ccc">
                    <table id="tbllocation" class="table table-striped table-bordered dt-responsive nowrap" style="width:100%;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Location</th>
                                <th>Show In CPX</th>
                                <th>Show as SubLocation</th>
                                <th>Parent</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        LoadTable();
        LoadLocation();
    });

    function LoadLocation() {
        $.ajax({
            type: "GET",
            url: "/Admin/GetLocationView",
            //data: "id=",
            success: function (data) {
                //data = data.aaData;
                //console.log(data);
                var options = [];
                options.push('<option value="0">- Select Location -</option>');
                for (var i = 0; i < data.length; i++) {
                    if (data[i].ShowasSubLocation!=true)
                    options.push('<option value="' + data[i].LocationId + '">' + data[i].LocationName + '</option>');
                }
                $("#ddlLocation").html(options.join(''));
            },
            error: function () {
                alert("error")
            }
        });
    }
    function SubmitForm() {
        $(".css-error").removeClass('css-error');
        if ($("#txtlocation").val() != "") {
            var task = {
                LocationName: $("#txtlocation").val(),
                LocationId: $("#hdnlocationId").val(),
                ShowinCPX: $("#ShowinCPX").prop("checked"),
                ShowasSubLocation: $("#ShowasSubLocation").prop("checked"),
                ParentLocationId: $("#ddlLocation").val(),
            };
            $.ajax({
                type: "POST",
                url: "/Admin/SaveLocation",
                data: task,
                success: function (data) {
                    alert(data);
                    clearAll();
                },
                error: function () {
                    alert("error")
                }
            });
        }
        else {
            $("#txtlocation").addClass('css-error');
            alert("Fields Required");
        }
    }
    function onDelete(id) {
        if (confirm('Are you sure you want to delete?')) {
            $.getJSON("@Url.Action("DeleteLocation", "Admin")", { id: id }, function (data) {
                clearAll();

            });
        } return false;
    }
    function clearAll() {
        $("#txtlocation").val("");
        $("#hdnlocationId").val("");
        $("#ShowinCPX").prop("checked", false);
        $("#ShowasSubLocation").prop("checked", false);
        $("#ddlLocation").val("");
        LoadTable();
    }

    function onEdit(a, b,c,d,e) {
        clearAll();
        $("#txtlocation").val(a);
        $("#hdnlocationId").val(b);
        $("#ShowinCPX").prop("checked",c);
        $("#ShowasSubLocation").prop("checked",d);
        $("#ddlLocation").val(e);
    }
    function LoadTable() {
        $('#tbllocation').dataTable({
            //  "bServerSide": true,
            "sAjaxSource": "@Url.Action("GetLocationViewJson", "Admin")",
            "bProcessing": true,
            "bDestroy": true,
            "aoColumns": [
                { "sName": "LocationId" },
                { "sName": "LocationName" },
                { "sName": "ShowinCPX" },
                { "sName": "ShowasSubLocation" },
                { "sName": "ParentLocationId" },
                {
                    "sName": "LocationId",
                    "bSortable": false,
                    "render": function (data, row, r) {
                        var lname = "'" + r[1] + "'";
                        var showinCPX = "'" + r[2] + "'";
                        var showasSubLocation = "'" + r[3] + "'";
                        var parentLocationId = "'" + r[4] + "'";
                    return '<div>' +
                        '<div style="width: 50px; float: left;"><span class="icon-edit"></span><a href="javascript:void(0)" onclick="onEdit(' + lname + ',' + data + ',' + showinCPX + ',' + showasSubLocation + ',' + parentLocationId + ')" >Edit</a></div>' +
                    '<div style="width: 80px; float: left;"><span class="icon-trash"></span><a href="javascript:void(0)" class="deleteLink" onclick="onDelete(' + data + ')">Delete</a></div></div>';
                   }
                }
            ],
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, 500, 1000], [10, 20, 30, 50, 100, 150, 200, 500, 1000]],
            "sDom": 'T<"clear">lfrtip',
            "oTableTools": {
                "sSwfPath": "/swf/copy_csv_xls_pdf.swf",
                "aButtons": [
                    "copy", "xls", "pdf"
                ]
            }
        });
        Applyclassdt();
    }
    function Applyclassdt() {
        $("#tbllocation_length").addClass("col-md-6");
        $("#tbllocation_info").addClass("col-md-6");
    }
</script>