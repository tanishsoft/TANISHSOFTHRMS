@{
    ViewBag.Title = "ManageDepartmentVsShiftType";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>
    var SubDeptList_PageLevel = new Array();
    $(document).ready(function () {
        LoadLocations();
        LoadShiftTypes();
        LoadData();
        GetAllSubDepartmentListToAdmin_OnLoad();
    });
    var shifttypesdata;
    function funShowAdd() {
        $("#myModal").modal('show');
    }
    function GetShiftType(id) {
        for (var i = 0; i < shifttypesdata.length; i++) {
            if (shifttypesdata[i].ShiftTypeId == id)
                return shifttypesdata[i];
        }
    }
    function Save() {
        var shft = GetShiftType($("#ddlShifttype").val());
        if (shft != null) {
            var task = {
                DepartmentName: $("#ddlDepartment option:selected").text(),
                DepartmentId: $("#ddlDepartment").val(),
                LocationId: $("#ddlLocation").val(),
                LocationName: $("#ddlLocation option:selected").text(),
                //Name: $("#txtName").val(),
                ShiftTypeId: shft.ShiftTypeId,
                ShiftTypeName: shft.ShiftTypeName,
                ShiftStartTime: shft.ShiftStartTime,
                ShiftEndTime: shft.ShiftEndTime,
                SubDeptID: $("#ddlSubDepartment").val(),
            };
            $.ajax({
                type: "POST",
                url: "/Admin/SaveDepartmentShiftType",
                data: task,
                success: function (data) {
                    // alert(data);
                    $("#myModal").modal('hide');
                    LoadData();
                },
                error: function () {
                    alert("error")
                }
            });
        } else {
            alert("Please select fields");
        }
    }
    function LoadLocations() {
        $.ajax({
            type: "POST",
            url: "/Common/GetLocations",
            //data: "id=",
            success: function (data) {
                var options = [];
                options.push('<option value="">- Select Location -</option>');
                for (var i = 0; i < data.length; i++) {
                    options.push('<option value="' + data[i].LocationId + '">' + data[i].LocationName + '</option>');
                }
                $("#ddlLocation").html(options.join(''));
                $("#ddlLocationForFilter").html(options.join(''));
            },
            error: function () {
                alert("error")
            }
        });
    }
    function LoadDepartment() {
        $.ajax({
            type: "POST",
            url: "/Common/GetDepartmentByLocation",
            data: "id=" + $("#ddlLocation").val(),
            success: function (data) {
                var options = [];
                options.push('<option value="">- Select Department -</option>');
                for (var i = 0; i < data.length; i++) {
                    options.push('<option value="' + data[i].DepartmentId + '">' + data[i].DepartmentName + '</option>');
                }
                $("#ddlDepartment").html(options.join(''));
            },
            error: function () {
                alert("error")
            }
        });
    }
    function LoadShiftTypes() {
        $.ajax({
            type: "POST",
            url: "/Common/GetShiftTypes",
            //data: "id=" + $("#ddlLocation").val(),
            success: function (data) {
                var options = [];
                options.push('<option value="">- Select Shift Type -</option>');
                for (var i = 0; i < data.length; i++) {
                    options.push('<option value="' + data[i].ShiftTypeId + '">' + data[i].ShiftTypeName + '</option>');
                }
                $("#ddlShifttype").html(options.join(''));
                shifttypesdata = data;
            },
            error: function () {
                alert("error")
            }
        });
    }
    function LoadData() {
        $('#TblList').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/Admin/AjaxDepartmentShiftType",
            "bProcessing": true,
            "bDestroy": true,
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, -1], [10, 20, 30, 50, 100, 150, 200, "All"]],
            //"aaSorting": [[0, "desc"]],
            "aoColumns": [{ "sName": "DepartmentShiftId" },
                       { "sName": "LocationName" },
                       { "sName": "DepartmentName" },
                       { "sName": "ShiftTypeName" },
                       { "sName": "ShiftStartTime" },
                       { "sName": "ShiftEndTime" },
                       {
                           "sName": "DepartmentShiftId",
                           "bSortable": false,
                           "render": function (data) {
                               return '<a href="#" id="' + data + '" onclick="DeleteSudDepartment(this.id);">Delete</a>';
                           }
                       }
            ],
            "fnServerParams": function (aoData) {
                aoData.push(
                    { "name": "locationid", "value": $("#ddlLocationForFilter").val() },
                    { "name": "departmentid", "value": $("#ddlDepartmentForFilter").val() }


                );
            }
        });
        $("#TblList_length").addClass("col-md-6");

    }
    function DeleteSudDepartment(id) {
        if (confirm("Are you sure you want to delete?")) {
            $.ajax({
                type: "POST",
                url: "/Admin/DeleteDepartmentShiftType",
                data: { id: id },
                success: function (data) {
                    alert(data);
                    LoadData();
                },
                error: function () {
                    alert("error")
                }
            });
        }
    }

    function GetAllSubDepartmentListToAdmin_OnLoad() {
        if (SubDeptList_PageLevel.length == 0) {
            SubDeptList_PageLevel = new Array();
            $.ajax({
                type: "POST",
                url: "/Admin/GetAllSubDepatmentListToAdmin",
                success: function (data) {
                    SubDeptList_PageLevel = data;
                },
                error: function () {
                    alert("error")
                }
            });
        }
    }

    function BindSubDeptListToDDL_OnDeptChange(DeptID) {
        var Options = '<option value="">- Select Sub Dept -</option>';
        if ($.isNumeric(DeptID)) {
            for (var i in SubDeptList_PageLevel) {
                if (SubDeptList_PageLevel[i].DepartmentId == parseFloat(DeptID)) {
                    Options += '<option value="' + SubDeptList_PageLevel[i].SubDepartmentId + '">' + SubDeptList_PageLevel[i].Name + '</option>';
                }
            }
        }
        $("#ddlSubDepartment").html(Options);
    }


    function LoadDepartmentForFilter() {
        if ($("#ddlLocationForFilter").val() != null && $("#ddlLocationForFilter").val() != "") {
            $.ajax({
                type: "POST",
                url: "/Common/GetDepartmentByLocation",
                data: "id=" + $("#ddlLocationForFilter").val(),
                success: function (data) {
                    var options = [];
                    options.push('<option value="">- Select Department -</option>');
                    for (var i = 0; i < data.length; i++) {
                        options.push('<option value="' + data[i].DepartmentId + '">' + data[i].DepartmentName + '</option>');
                    }
                    $("#ddlDepartmentForFilter").html(options.join(''));
                },
                error: function () {
                    alert("error")
                }
            });
        } else {
            var options = [];
            options.push('<option value="">- Select Department -</option>');

            $("#ddlDepartmentForFilter").html(options.join(''));
        }
    }

</script>

<div class="panel panel-default">
    <div class="panel-heading">
        Manage Department Vs ShiftType
        <span class="pull-right" style="color:green;font-weight:bold;cursor:pointer;" onclick="funShowAdd();">Create New</span>
    </div>
    <div class="panel-body">
        <div class="col-md-12" style="padding-bottom:5px;">
            <div class="col-md-2">
                <select id="ddlLocationForFilter" class="form-control" style="max-width:200px;" onchange="LoadDepartmentForFilter();">
                    <option value="">Select Location</option>
                </select>

            </div>
            <div class="col-md-2">
                <select id="ddlDepartmentForFilter" class="form-control" style="max-width:200px;">
                    <option value="">Select Department</option>
                </select>
            </div>
            <div class="col-md-2">
                <div class="col-md-2"><input type="button" class="btn btn-sm btn-success" value="Go" onclick="LoadData();" /> </div>
            </div>

        </div>
        <table class="table table-bordered table-hover table-responsive" id="TblList">
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>Location</th>
                    <th>Department</th>
                    <th>Shift Type</th>
                    <th>Shift Starttime</th>
                    <th>Shift End Time</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">   Department Vs Shift Type</h4>
            </div>
            <div class="modal-body">


                <div class="row form-group">
                    <div class="col-md-2">
                        <span>Location</span>&nbsp;<span class="MandatorySpanCSS"></span>
                    </div>
                    <div class="col-md-6">
                        <select class="form-control SRequired" id="ddlLocation" onchange="LoadDepartment()">
                            <option value="">Select Location</option>
                        </select>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-md-2">
                        <span>Department</span>&nbsp;<span class="MandatorySpanCSS"></span>
                    </div>
                    <div class="col-md-6">
                        <select class="form-control SRequired" id="ddlDepartment" onchange="BindSubDeptListToDDL_OnDeptChange(this.value);">
                            <option value="">Select Department</option>
                        </select>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-md-2">
                        <span>Sub-Department</span>
                    </div>
                    <div class="col-md-6">
                        <select class="form-control" id="ddlSubDepartment">
                            <option value="">Select Sub-Department</option>
                        </select>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-md-2">
                        <span>Shift Type</span>&nbsp;<span class="MandatorySpanCSS"></span>
                    </div>
                    <div class="col-md-6">
                        <select class="form-control SRequired" id="ddlShifttype">
                            <option value="">Select Shift Type</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" value="Save" onclick="Save();">Submit</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>