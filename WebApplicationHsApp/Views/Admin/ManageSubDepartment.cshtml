@{
    ViewBag.Title = "ManageSubDepartment";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script>
    $(document).ready(function () {
        LoadLocations();
        LoadData();
    });
    function funShowAdd() {
        $("#myModal").modal('show');
    }
    function LoadLocations() {
        $.ajax({
            type: "POST",
            url: "/Common/GetLocations",
            //data: "id=",
            success: function (data) {
                var options = [];
                options.push('<option value="">- Select Location -</option>');
                for (var i = 0; i < data.length; i++) {
                    options.push('<option value="' + data[i].LocationId + '">' + data[i].LocationName + '</option>');
                }
                $("#ddlLocation").html(options.join(''));
            },
            error: function () {
                alert("error")
            }
        });
    }
    function LoadDepartment() {
        $.ajax({
            type: "POST",
            url: "/Common/GetDepartmentByLocation",
            data: "id=" + $("#ddlLocation").val(),
            success: function (data) {
                var options = [];
                options.push('<option value="">- Select Department -</option>');
                for (var i = 0; i < data.length; i++) {
                    options.push('<option value="' + data[i].DepartmentId + '">' + data[i].DepartmentName + '</option>');
                }
                $("#ddlDepartment").html(options.join(''));
            },
            error: function () {
                alert("error")
            }
        });
    }
    function Save() {
        if ($("#ddlDepartment").val() != null && $("#ddlDepartment").val() != "" && $("#ddlLocation").val() != null && $("#ddlLocation").val() != "" && $("#txtName").val() != null && $("#txtName").val() != "") {
            var task = {
                DepartmentName: $("#ddlDepartment option:selected").text(),
                DepartmentId: $("#ddlDepartment").val(),
                LocationId: $("#ddlLocation").val(),
                LocationName: $("#ddlLocation option:selected").text(),
                Name: $("#txtName").val()
            };
            $.ajax({
                type: "POST",
                url: "/Admin/SaveSubDepartment",
                data: task,
                success: function (data) {
                    $("#myModal").modal('hide');
                    LoadData();
                },
                error: function () {
                    alert("error")
                }
            });
        } else {
            alert("Please fill all the required fields");
        }
    }
    function LoadData() {
        $('#TblList').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/Admin/AjaxSubDepartment",
            "bProcessing": true,
            "bDestroy": true,
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, -1], [10, 20, 30, 50, 100, 150, 200, "All"]],
            //"aaSorting": [[0, "desc"]],
            "aoColumns": [{ "sName": "SubDepartmentId" },
                       { "sName": "LocationName" },
                       { "sName": "DepartmentName" },
                       { "sName": "Name" },
                       {
                           "sName": "SubDepartmentId",
                           "bSortable": false,
                           "render": function (data) {
                               return '<a href="#" id="' + data + '" onclick="DeleteSudDepartment(this.id);">Delete</a>';
                           }
                       }
            ],
        });
        $("#TblList_length").addClass("col-md-6");

    }
    function DeleteSudDepartment(id) {
        if (confirm("Are you sure you want to delete?")) {
            $.ajax({
                type: "POST",
                url: "/Admin/DeleteSubDepartment",
                data: { id: id },
                success: function (data) {
                    LoadData();
                },
                error: function () {
                    alert("error")
                }
            });
        }
    }
</script>
<div class="panel panel-default">
    <div class="panel-heading">
        Manage Sub Departments
        <span class="pull-right" style="color:green;font-weight:bold;cursor:pointer;" onclick="funShowAdd();">Create New</span>
    </div>
    <div class="panel-body">
        <table class="table table-bordered table-hover table-responsive" id="TblList">
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>Location</th>
                    <th>Department</th>
                    <th>Sub Department</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">    New Sub Department</h4>
            </div>
            <div class="modal-body">


                <div class="row form-group">
                    <div class="col-md-2">
                        <span>Location <span style="color:red;">*</span></span>
                    </div>
                    <div class="col-md-6">
                        <select class="form-control SRequired" id="ddlLocation" onchange="LoadDepartment()">
                            <option value="">Select Location</option>
                        </select>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-md-2">
                        <span>Department<span style="color:red;">*</span></span>
                    </div>
                    <div class="col-md-6">
                        <select class="form-control SRequired" id="ddlDepartment">
                            <option value="">Select Department</option>
                        </select>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-md-2">
                        <span>Name<span style="color:red;">*</span></span>
                    </div>
                    <div class="col-md-6">
                        <input type="text" class="form-control SRequired" id="txtName" />
                        <input type="hidden" class="form-control " id="txtid" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" value="Save" onclick="Save();">Submit</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>