
@{
    ViewBag.Title = "EmployeeCompOffRequests";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script>
    $(document).ready(function () {
        ApprovedDataTable();
        LoadEmployees();
        $("#txtCompOffDate").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: "dd/mm/yy",
            maxDate: "0",
            yearRange: "-100:+0"
        });
        BindEditshifttypes();
    });
    function BindEditshifttypes() {
        var options = [];
        options.push('<option value="">Select</option>');
        $.ajax({
            type: 'POST',
            url: "/Hr/GetShiftType",
            data: 'id=1',
            dataType: "json",
            success: function (result) {
                for (var i = 0; i < result.length; i++) {
                    if (result[i].Name != null) {
                        options.push('<option value="' + result[i].id + '">' + result[i].Name + '</option>');
                    }
                }
                $("#ddlshifttypesofcompoffrequest").html(options.join(''));
            },
            error: function () {
                alert('error');
            }
        });
    }
    function ApprovedDataTable() {
        $('#ApprovedDataTable').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/Manager/AjaxAllRequestCompOffView",
            "bProcessing": true,
            "bDestroy": true,
            "aoColumns": [
                  //{ "sName": "LeaveId" },
                    { "sName": "UserId" },
                      { "sName": "UserName" },
                     { "sName": "DepartmentName" },

                            { "sName": "LocationName" },
                            { "sName": "CompOffDateTime" },
                            { "sName": "RequestReason" },
                            { "sName": "Leave_Status" },
                            { "sName": "CreatedDateTime" }
            ],
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, 500, 1000], [10, 20, 30, 50, 100, 150, 200, 500, 1000]],
            "sDom": 'T<"clear">lfrtip',
            "oTableTools": {
                "sSwfPath": "/swf/copy_csv_xls_pdf.swf",
                "aButtons": [
                    "copy", "xls", "pdf"
                ]
            }

        });
        $("#ApprovedDataTable_length").addClass("col-md-6");
        $("#ApprovedDataTable_info").addClass("col-md-6");
    }
    function myModalCompOffRequestShow() {
        $("#myViewPermision").modal('show');
    }
    function LoadEmployees() {
        $.ajax({
            type: "POST",
            url: "/Manager/GetMyEmployeelist",
            success: function (data) {
                var options = [];
                options.push('<option value="">- Select Employee -</option>');
                for (var i = 0; i < data.length; i++) {
                    options.push('<option value="' + data[i].CustomUserId + '">' + data[i].FirstName + " " + data[i].LastName + '</option>');
                }
                $("#ddlEmployees").html(options.join(''));
            },
            error: function () {
                alert("error")
            }
        });
    }

    function ApplyNewCompOffLeave_PageLevel() {
        var ReqCompOffDate = $("#txtCompOffDate").val();
        var ReasonForCompOff = $("#txtReasonForCompOffLeave").val() + " - The Shift worked : " + $("#ddlshifttypesofcompoffrequest option:selected").text();;
        if (ValidateRequiredFieldsByClassName_GlobalJS("CompOffRequiredField")) {
            var Dataparam = {
                CompOffDate: ReqCompOffDate,
                RequestReason: ReasonForCompOff,
                ShiftTypeId: $("#ddlshifttypesofcompoffrequest").val(),
                DayWorkedType: $("#ddltypeofdayworked").val(),
                UserId: $("#ddlEmployees").val()
            };
            $.ajax({
                type: "POST",
                url: "/Hr/RequestNewCompOffLeaveByManager",
                data: Dataparam,
                success: function (data) {
                    $("#txtCompOffDate").val('');
                    $("#txtReasonForCompOffLeave").val('');
                    OpenSuccessAlertPopUpBox_ConfirmPopUpJS(data);
                    if (data == "Success") {
                        GetRequestedComOffLeaveListToUser_PageLevel();
                        ClicklistItem('ViewCompOffLeaveRequestList');
                        GetRequestedComOffLeaveListToManagerToApprove_PageLevel();
                    }
                },
                error: function () {
                    alert("error")
                }
            });

        } else {
            OpenSuccessAlertPopUpBox_ConfirmPopUpJS("Please Enter Mandatory Fields");
        }
    }
</script>
<div class="panel panel-default">
    <div class="panel-heading">Employees CompOff Applications <span class="pull-right" onclick="myModalCompOffRequestShow();" style="cursor:pointer;color:green;"> New Request</span> </div>
    <div class="panel-body">

        <table id="ApprovedDataTable" class="table table-striped table-bordered  dt-responsive " style="width:100%;">
            <thead>
                <tr>
                    <td>User Id</td>
                    <td>User Name</td>
                    <td>Department</td>
                    <th>Location</th>
                    <th>CompOff</th>
                    <th>Request Reason</th>
                    <th>Leave Status  </th>
                    <th>Created On</th>

                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
<div id="myViewPermision" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Comoff Request</h4>
            </div>
            <div class="modal-body">
                <table class="table" style="width:80%;">
                    <tr>
                        <td>Select Employee</td>
                        <td>
                            <select class="form-control CompOffRequiredField" id="ddlEmployees"></select>
                        </td>
                    </tr>
                    <tr>
                        <td>Comp Off Date<span style="color:red;">*</span></td>
                        <td><input class="form-control CompOffRequiredField" id="txtCompOffDate" type="text" placeholder="" /></td>
                    </tr>
                    <tr>
                        <td>Reason<span style="color:red;">*</span></td>
                        <td><input class="form-control CompOffRequiredField" id="txtReasonForCompOffLeave" type="text" placeholder="" /></td>
                    </tr>
                    <tr>
                        <td>Which Shift you are in? <span style="color:red;">*</span></td>
                        <td><select class="form-control CompOffRequiredField" id="ddlshifttypesofcompoffrequest"></select></td>
                    </tr>
                    <tr>
                        <td>
                            Full Day or Half Day
                        </td>
                        <td>
                            <select id="ddltypeofdayworked" class="form-control">
                                <option value="Full Day">Full Day</option>
                                <option value="Half Day">Half Day</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
                            <input class="btn btn-primary" type="button" value="Save" onclick="ApplyNewCompOffLeave_PageLevel()" />&nbsp;<input class="btn btn-default" type="button" onclick="ResetFieldsByClassName_GlobalJS('CompOffRequiredField');" value="Cancel" />
                        </td>
                    </tr>
                </table>

            </div>
            <div class="modal-footer">

                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>
