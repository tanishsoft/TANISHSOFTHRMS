
@{
    ViewBag.Title = "Tasks";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>
    $(document).ready(function () {ddlLocationForFilter
        datatablebind();
        
    });
    
    function Applyclassdt() {
        $("#myDataTable_length").addClass("col-md-6");
        $("#myDataTable_info").addClass("col-md-6");

    }
    function datatablebind() {
        $('#myDataTable').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/Home/AjaxbyUserview",
            "bProcessing": true,
            "bDestroy": true,
            "aoColumns": [
                            { "sName": "TaskId" },
                            { "sName": "Call_Date" },
                            { "sName": "ResTime" },
                            //{ "sName": "CreatorLocationName" },
                            { "sName": "Creator" },
                            { "sName": "Floor" },
                            { "sName": "ExtensionNo" },
                            { "sName": "AssertEquipId" },
                            { "sName": "AssertEquipName" },
                            { "sName": "Nature_Of_Problem" },
                            { "sName": "Assign" },
                            { "sName": "Work_done" },
                            { "sName": "Total_Time_Taken" },
                            { "sName": "Status" },
                            { "sName": "SloverStatus" },
                            {
                                "sName": "id",//myModalAssignTasktoepmloyee
                                "bSortable": false,
                                "render": function (data) {
                                    return '<div class="btn-group">' +
  '<div class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-th-list"></span></div>' +
  '<ul class="dropdown-menu dropdown-menu-right">' +
    
                                    '<li><a href="/Home/ViewTask/' + data + '" id="' + data + '">View Task</a></li>' +
                                    '<li><a href="/Home/EditTask/' + data + '" id="' + data + '">Edit Task</a></li>' +
                                        '<li><a href="#" id="' + data + '" onclick="DoneTaks(this.id);">Done Task</a></li> ' +
'<li><a href="#" id="' + data + '" onclick="ViewComments(this.id);">View Comments</a></li> ' +

//'<li><a href="#" id="' + data + '" onclick="ViewFiles(this.id);">View Files</a></li> ' +
                                        '<li><a href="#" id="' + data + '" onclick="DeleteTask(this.id);">Delete Task</a></li> ' +

  '</ul></div>';
                                }
                            }

            ],
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, 500, 1000], [10, 20, 30, 50, 100, 150, 200, 500, 1000]],
            //"aaSorting": [[0, "asc"]],


            "fnServerParams": function (aoData) {
                aoData.push(
                    { "name": "locationid", "value": $("#ddlLocationForFilter").val() },
                    { "name": "departmentid", "value": $("#ddlDepartmentForFilter").val() },
                    { "name": "status", "value": $("#ddlStatusTypeForFilter").val() },
                    { "name": "Emp", "value": $("#ddlEmployeesForFilter").val() },
                    { "name": "fromdate", "value": $("#txtfromdate").val() },
                    { "name": "todate", "value": $("#txttodate").val() }

                );
            },

            "sDom": 'T<"clear">lfrtip',
            "oTableTools": {
                "sSwfPath": "/swf/copy_csv_xls_pdf.swf",
                "aButtons": [
                    "copy", "xls", "pdf"
                ]
            },
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                // $('td:eq(7)', nRow).html(GetNameofempbyempid(aData[7]));
                switch (aData[12]) {
                    case 'Pending':
                      //  $(nRow).css('class', 'myClassred');
                        $('td:eq(12)', nRow).css('background-color', '#FA6800');
                        break;
                    case 'New':
                        //$(nRow).css('background-color', 'green')
                        $('td:eq(12)', nRow).css('background-color', '#8FBC8F');
                        break;
                    case 'In Progress':
                        //$(nRow).css('background-color', 'blue')
                        $('td:eq(12)', nRow).css('background-color', '#DAA520');
                        break;
                   case 'Rejected':
                       $('td:eq(12)', nRow).css('background-color', '#a71f23');
                        break;
                    default:
                        $('td:eq(12)', nRow).css('background-color', 'Green');
                        break;
                }
            }
        });
        Applyclassdt();
    }
    function DoneTaks(id) {
        var tdata = {
            id: id
        };
        $.ajax({
            type: "GET",
            url: "/Home/DoneTask",
            data: tdata,
            success: function (data) {
                if (data == "Success") {
                    datatablebind();
                } else { alert(data); }
            },
            error: function () {
                alert("error")
            }
        });
    }





  
    function DeleteTask(id) {
        if (confirm("Are you sure you want to delete?")) {
            var tdata = {
                id: id
            };
            $.ajax({
                type: "GET",
                url: "/Home/DeleteTask",
                data: tdata,
                success: function (data) {
                    if (data == "Success") {
                        datatablebind();
                    } else { alert(data); }
                },
                error: function () {
                    alert("error")
                }
            });
        }
    }



    function ViewComments(id) {
        currnetid = id;
        $.ajax({
            type: "GET",
            url: "/Home/GetMyTaskComments",
            data: "taskid=" + id,
            success: function (data) {
                var html = "";
                var count = 1;
                for (var i = 0; i < data.length; i++) {
                    html += "<tr>";
                    html += "<td>" + count + "</td>";
                    html += "<td>" + data[i].Comment + "</td>";
                    html += "<td>" + data[i].CommentedBy + "</td>";
                    html += "<td>" + functionDate(data[i].CommentDate) + "</td>";
                    html += "</tr>";
                    count = count + 1;
                }
              
                $("#tblbodycomments").html(html);
               $("#myModalComments").modal('show');
               
            },
            error: function () {
                alert("error")
            }
        });


    }

  

</script>


<div class="panel panel-default">
    <div class="panel-heading">My Task</div>
    <div class="panel-body">
        <div class="col-md-12" style="padding-bottom:5px;">
          
        <table id="myDataTable" class="table table-striped table-bordered  dt-responsive " style="width:100%;">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Call Date</th>
                    <th>Response Time</th>
                    <th>Creator  </th>
                    <th>Place</th>
                    <th>Extension no</th>
                    <th>Assert No</th>
                    <th>Equipment Name</th>
                    <th>Description</th>
                    <th>Assign</th>
                    <th>Work done</th>
                    <th>Total Time Taken</th>
                    <th>Status</th>
                    <th>User Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="myDataTabletaskbody"></tbody>
        </table>
    </div>
</div>
    </div>
<div id="myModalComments" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Comments </h4>
            </div>
            <div class="modal-body">
                <div class="row" style="padding:5px;">
                    <div class="col-md-4">
                        <label for="name">Comment<span style="color:red;">*</span></label>
                    </div>
                    <div class="col-md-6">
                        <textarea class="form-control" id="workcomments"></textarea>
                    </div>
                    <div class="col-md-2">
                        <input type="button" id="btnasigntask" value="Save" class="btn btn-primary" onclick="SaveNewComment();" />
                    </div>

                </div>
                <div class="row">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>
                                    S.No
                                </th>
                                <th>
                                    Comment
                                </th>
                                <th>Commented By</th>
                                <th>Commented On</th>
                            </tr>
                        </thead>
                        <tbody id="tblbodycomments"></tbody>

                    </table>
                </div>

            </div>

        </div>

    </div>
</div>
