
@{
    ViewBag.Title = "ApprovalCellPhoneRequest";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<script>
    var eId = 0;
    var type = "Approval";
    $(document).ready(function () {

        LoadData();
    });
    function LoadData() {
        $('#tblRequest').dataTable({
            "bServerSide": true,
            "sAjaxSource": "/Custom/AjaxGetCellPhoneRequestforApproval",
            "bProcessing": true,
            "bDestroy": true,
            "aLengthMenu": [[10, 20, 30, 50, 100, 150, 200, -1], [10, 20, 30, 50, 100, 150, 200, "All"]],
            "aoColumns": [

                { "sName": "Id" },
                { "sName": "EmpNo" },
                { "sName": "Name" },
                { "sName": "Designation" },
                { "sName": "Department" },
                 { "sName": "Purpose" },
                { "sName": "CurrentApprover" },
                { "sName": "Status" },

                {
                    "sName": "Id",
                    "bSortable": false,
                    "render": function (data) {

                        return '<div class="btn-group">' +
                            '<div class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-th-list"></span></div>' +
                            '<ul class="dropdown-menu dropdown-menu-right">' +
                            '<li><a href="javascript:void(0);"  onclick="Approval(' + data + ')">Approval</a></li>' +
                            '<li><a href="javascript:void(0);"  onclick="Reject(' + data + ')">Reject</a></li>' +
                            '</ul></div>';
                    }
                }
            ]
            //"fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {

            //    //  $('td:eq(4)', nRow).html('<a href="javascript:void(0);" id="' + aData[0] + '" onclick="ViewComponents(this.id);">View</a>');
            //    //<a href="javascript:void(0);" id="' + data + '" onclick="StartTask(this.id);">Pick Up</a>
            //    if (aData[5] != 0)
            //        $('td:eq(5)', nRow).html('<span>' + aData[5] + '  Asset<span>&nbsp;<a href="javascript:void(0);" id="' + aData[0] + '" onclick="ViewTotalAssets(this.id);">To View</a>');
            //    else
            //        $('td:eq(5)', nRow).html('<span>' + aData[5] + '  Asset<span>');

            //    $('td:eq(5)', nRow).css('color', 'blue').css('font-weight', 'bold');
            //    if (aData[6] != 0)
            //        $('td:eq(6)', nRow).html('<span>' + aData[6] + '  User <span>&nbsp;<a href="javascript:void(0);" id="' + aData[0] + '" onclick="ViewAssignUserDetails(this.id);">To View</a>');
            //    else
            //        $('td:eq(5)', nRow).html('<span>' + aData[6] + '  Asset<span>');
            //    $('td:eq(6)', nRow).css('color', 'orange').css('font-weight', 'bold');
            //    $('td:eq(7)', nRow).css('color', 'green').css('font-weight', 'bold');
            //}
        });
        $("#tblRequest_length").addClass("col-md-6");
        $("#tblRequest_length").addClass("col-md-6");
    }
    function Approval_Reject_Request() {
        
        if ($("#txtapprovecomments").val() != "") {
            $.get("/Custom/Approval_Reject_CellPhoneRequest?id=" + eId + "&status=" + type + "&comments=" + $("#txtapprovecomments").val() + "&type=" + $("#RequestType").val(), function (data) {
                $("#myModal").modal("hide");
                window.location.reload();
            });
        }
        else {
            $(".error").hide();
            $(".css-error").removeClass('css-error');
            $("#txtapprovecomments").after('<span class="error" style="color:Red;">Enter comment</span>');
            $("#txtapprovecomments").addClass('css-error');
        }
    }
    function Reject(id) {
        eId = id;
        type = "Reject";
        $.get("/Custom/GetCellPhoneRequest", { id: id }, function (data) {
            $("#RequestType").val(data.RequestType);
            $('#btnApproveReject').val("Reject");
            $("#headerapprove").html('<b>Reject</b> <button type="button" class="pull-right close" data-dismiss="modal">&times;</button>');

            $("#myModal").modal("show");
        });
    }
    function NewRequest() {
        window.location.replace("/Custom/CellPhoneRequest");
    }
    function Approval(id) {
        eId = id;
        type = "Approval";
        $.get("/Custom/GetCellPhoneRequest", { id: id }, function (data) {
            $("#RequestType").val(data.RequestType);
            $("#headerapprove").html('<b>Approve</b> <button type="button" class="pull-right close" data-dismiss="modal">&times;</button>');
            $('#btnApproveReject').val("Approve");
            $("#myModal").modal("show");
        });
      
    }
</script>
<div class="panel panel-default">
    <div class="panel-heading">Manage Cell Phone Request</div>
    <div class="panel-body">
        <table class="table table-striped table-bordered dt-responsive nowrap" style="width:100%;" id="tblRequest">
            <thead>
                <tr style="background-color: #786C67;color: white;">

                    <th>Id</th>
                    <th>EmpNo</th>
                    <th>Name</th>
                    <th>Designation</th>
                    <th>Department</th>
                    <th>Purpose</th>
                    <th>Current Approver</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
<div class="modal fade" id="myModal" role="dialog">
    <div class="form-block">
        <div class="header" style="font:100px; " id="headerapprove" >Approve<button type="button" class="pull-right close" data-dismiss="modal">&times;</button></div>
        <form id="AddNewTask" method="post" enctype="multipart/form-data">
            <!-- Grid row -->
            <div class="form-row">
                <div class="form-group col-md-12">
                    <label>Request Type<span style="color:red;">*</span></label>
                    <select class="form-control maxwidth" id="RequestType">
                        <option value="">Select Request Type</option>
                        <option value="Only SIM">Only SIM</option>
                        <option value="SIM + Normal Mobile">SIM + Normal Mobile</option>
                        <option value="SIM + Touch Phone">SIM + Touch Phone</option>
                    </select>
                </div>
                <div class="form-group col-md-12">
                    <label>Comments<span style="color:red;">*</span></label>
                    <textarea id="txtapprovecomments" class="form-control"></textarea>
                </div>
                <div class="form-group col-md-12">
                    <input type="button" id="btnApproveReject" class="btn save header" onclick="Approval_Reject_Request();" />
                    <button type="button" data-dismiss="modal" class="btn cancel">Cancel</button>
                </div>
                <div class="clearfix"></div>
            </div>

            <!-- Grid row -->


        </form>
    </div>
</div>

